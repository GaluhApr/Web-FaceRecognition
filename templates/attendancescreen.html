<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>
        {% block title %}
        {% endblock title %}

    </title>
    {% include "snippets/style.html" %}

</head>

<body class="sb-nav-fixed">

    <!-- navbar -->
    {% include "snippets/navscreen.html" %}
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                {% block header %}

                {% endblock header %}
                <div class="card mb-4">
                    <div class="card-header">
                        {% block cardheader %}
                        



                        {% endblock cardheader %}
                    </div>
                    <div class="card-body">
                        {% block cardtable %}
                        <div class="container-fluid">
                          <div class="row mt-5 mb-5">
                              <div class="col-md-8">
                                  <img src="{% url 'videostream' %}" width="80%" class="img-thumbnail">
                              </div>
                              <div class="col-md-4" style="height:500px; overflow-y:auto;">
                                  <h3>Today Scan</h3>
                                  <table class="table">
                                      <thead>
                                          <tr>
                                              <th>Person #</th>
                                              <th>Name</th>
                                              <th>Skill</th>
                                              <th>Added</th>
                                          </tr>
                                      </thead>
                                      <tbody >
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                        </div>
                        
                        <script type="text/javascript">
                          $(document).ready(function () {
                              let lastcnt = 0;
                              let cnt;
                              chkNewScan();
                        
                              function chkNewScan() {
                                  countTodayScan();
                                  setTimeout(chkNewScan, 1000);
                              }
                        
                              function countTodayScan() {
                                  $.ajax({
                                      url: '/countTodayScan',
                                      type: 'GET',
                                      dataType: 'json',
                                      success: function (data) {
                                          cnt = data.rowcount;
                                          if (cnt > lastcnt) {
                                              reloadTable();
                                          }
                        
                                          lastcnt = cnt;
                                      },
                                      error: function (result) {
                                          console.log('no result!')
                                      }
                                  })
                              }
                        
                              function reloadTable() {
                                  $.ajax({
                                      url: '/loadData',
                                      type: 'GET',
                                      dataType: 'json',
                                      success: function (response) {
                                          var tr = $("#scandata");
                                          tr.empty();
                        
                                          $.each(response, function (index, item) {
                                              if (item.length > 0) {
                                                  for (let i = 0; i < item.length; i++) {
                                                      tr.append('<tr>' +
                                                          '<td>' + item[i][1] + '</td>' +
                                                          '<td>' + item[i][2] + '</td>' +
                                                          '<td>' + item[i][3] + '</td>' +
                                                          '<td>' + item[i][4] + '</td>' +
                                                          '</tr>');
                                                  }
                                              }
                                          });
                                      },
                                      error: function (result) {
                                          console.log('no result!')
                                      }
                                  });
                              }
                          });
                        </script>
                        {% endblock cardtable %}
                    </div>
                </div>
            </div>
        </main>
        <footer class="py-4 bg-light mt-auto">
            <div class="container-fluid px-4">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">Copyright &copy; Newbie Team</div>
                    <div>
                        <a href="#">Privacy Policy</a>
                        &middot;
                        <a href="#">Terms &amp; Conditions</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    </div>

    {% include "snippets/script.html" %}
</body>

</html>
